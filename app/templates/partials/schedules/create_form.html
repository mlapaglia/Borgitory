<!-- Create Schedule -->
<div class="border rounded-lg p-4">
    <h3 class="font-medium text-gray-700 mb-3">Create Schedule</h3>
    <form 
        hx-post="/api/schedules/" 
        hx-ext="json-enc"
        hx-target="#schedule-status"
        hx-on::before-request="prepareScheduleSubmission(event)"
        hx-on::after-request="handleScheduleResponse(event)"
    >
        <div class="space-y-4">
            <div>
                <label class="block text-sm font-medium text-gray-700">Name</label>
                <input type="text" name="name" required placeholder="Daily backup" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-gray-900">
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Repository</label>
                <select name="repository_id" required class="select-modern w-full">
                    <option value="">Select Repository...</option>
                    {% for repo in repositories %}
                    <option value="{{ repo.id }}">{{ repo.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Source Path</label>
                <div class="relative">
                    <input type="text" name="source_path" id="schedule-source-path" value="/data" 
                           class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-gray-900"
                           autocomplete="off">
                    <div id="schedule-source-path-dropdown" class="absolute z-10 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 hidden">
                    </div>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Schedule</label>
                <select onchange="updateCronExpression()" id="schedule-preset" class="select-modern w-full">
                    <option value="">Select a preset...</option>
                    <option value="0 2 * * *">Daily at 2:00 AM</option>
                    <option value="0 2 * * 0">Weekly on Sunday at 2:00 AM</option>
                    <option value="0 2 1 * *">Monthly on 1st at 2:00 AM</option>
                    <option value="0 2 1,15 * *">Twice monthly (1st and 15th) at 2:00 AM</option>
                    <option value="0 2 */2 * *">Every 2 days at 2:00 AM</option>
                    <option value="custom">Custom (cron expression)</option>
                </select>
            </div>
            <div id="custom-cron" class="hidden">
                <label class="block text-sm font-medium text-gray-700">Custom Cron Expression</label>
                <input type="text" id="custom-cron-input" placeholder="0 2 * * *" class="mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500 text-gray-900">
                <p class="mt-1 text-sm text-gray-500">Format: minute hour day month weekday</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Archive Cleanup (Optional)</label>
                <select name="cleanup_config_id" id="schedule-cleanup-select" class="select-modern w-full">
                    <option value="">No cleanup</option>
                    {% for config in cleanup_configs %}
                    <option value="{{ config.id }}">{{ config.name }}</option>
                    {% endfor %}
                </select>
                <p class="mt-1 text-xs text-gray-500">Automatically prune old archives after each scheduled backup</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Cloud Backup (Optional)</label>
                <select name="cloud_sync_config_id" id="schedule-cloud-select" class="select-modern w-full">
                    <option value="">No cloud backup</option>
                    {% for config in cloud_sync_configs %}
                    <option value="{{ config.id }}">{{ config.name }}</option>
                    {% endfor %}
                </select>
                <p class="mt-1 text-xs text-gray-500">Automatically backup to cloud after each scheduled Borg backup</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Repository Check (Optional)</label>
                <select name="check_config_id" id="schedule-check-select" class="select-modern w-full">
                    <option value="">No check</option>
                    {% for config in check_configs %}
                    <option value="{{ config.id }}">{{ config.name }}</option>
                    {% endfor %}
                </select>
                <p class="mt-1 text-xs text-gray-500">Verify repository integrity after each scheduled backup</p>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700">Notifications (Optional)</label>
                <select name="notification_config_id" id="schedule-notification-select" class="select-modern w-full">
                    <option value="">No notifications</option>
                    {% for config in notification_configs %}
                    <option value="{{ config.id }}">{{ config.name }}</option>
                    {% endfor %}
                </select>
                <p class="mt-1 text-xs text-gray-500">Get notified when scheduled backup completes or fails</p>
            </div>
            <input type="hidden" name="cron_expression" id="cron-expression">
            <div id="cron-description" class="text-sm text-gray-600 bg-blue-50 p-2 rounded hidden"></div>
            <button type="submit" class="w-full bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700">
                Create Schedule
            </button>
        </div>
    </form>
    <div id="schedule-status" class="mt-4"></div>
</div>

<script>
// Initialize path autocomplete and other JavaScript for dynamically loaded form
if (typeof PathAutocomplete !== 'undefined') {
    new PathAutocomplete('schedule-source-path', 'schedule-source-path-dropdown');
}

// Initialize cron functionality if it exists
if (typeof updateCronExpression === 'function') {
    updateCronExpression();
}
</script>